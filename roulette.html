<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>いつだれがどこでなにした</title>
    <style>
        .roulette { margin: 20px; }
        .result { margin: 20px; font-size: 1.5em; }
        .twitter-link { margin: 20px; }
    </style>
</head>
<body>
    <h1>いつだれがどこでなにした</h1>
    <div class="roulette">
        <button id="control0">スタート 1</button>
        <div id="display0"></div>
    </div>
    <div class="roulette">
        <button id="control1">スタート 2</button>
        <div id="display1"></div>
    </div>
    <div class="roulette">
        <button id="control2">スタート 3</button>
        <div id="display2"></div>
    </div>
    <div class="roulette">
        <button id="control3">スタート 4</button>
        <div id="display3"></div>
    </div>
    <div class="result" id="finalResult" style="color: red; display: none;">結果: </div>
    <div class="twitter-link" style="display: none;">
        <a id="twitterLink" href="" target="_blank">ここをタップするとツイートするよ</a>
    </div>

    <script>
        const arrays = [
            ["昨日", "あさって", "おととい", "1時間後"],
            ["犬", "猫", "鳥", "魚"],
            ["東京", "大阪", "京都", "名古屋"],
            ["ご飯食べる", "映画見る", "スカイツリー行く", "ウェイウェイ遊ぶ"]
        ];

        let intervals = [null, null, null, null];
        let results = ["", "", "", ""];
        let stopped = [false, false, false, false];

        function startRoulette(index) {
            const displayElement = document.getElementById(`display${index}`);
            const array = arrays[index];
            let idx = 0;
            intervals[index] = setInterval(() => {
                displayElement.textContent = array[idx];
                idx = (idx + 1) % array.length;
            }, 100);
        }

        function stopRoulette(index) {
            clearInterval(intervals[index]);
            const displayElement = document.getElementById(`display${index}`);
            results[index] = displayElement.textContent;
            stopped[index] = true;
            document.getElementById(`control${index}`).textContent = "スタート " + (index + 1);
            checkAllStopped();
        }

        function checkAllStopped() {
            if (stopped.every(status => status)) {
                const finalResult = results[0]+"、"+results[1]+"が"+results[2]+"で"+results[3];

                const finalResultElement = document.getElementById("finalResult");
                const twitterLinkElement = document.getElementById("twitterLink");
                
                finalResultElement.textContent = "結果: " + finalResult;
                finalResultElement.style.display = "block";
                
                const encodedResult = encodeURIComponent(finalResult);
                twitterLinkElement.href = `https://twitter.com/intent/tweet?text=${encodedResult}&url=http%3A%2F%2F&via=cthulhumasters`;
                twitterLinkElement.parentNode.style.display = "block";  // Display the parent of the link
            }
        }

        for (let i = 0; i < arrays.length; i++) {
            document.getElementById(`control${i}`).addEventListener("click", function() {
                if (intervals[i]) {
                    stopRoulette(i);
                    intervals[i] = null;
                } else {
                    startRoulette(i);
                    stopped[i] = false;
                    this.textContent = "ストップ " + (i + 1);
                }
            });
        }
    </script>
</body>
</html>
